[{"id": "base", "parentIds": ["listens"], "sql": "(SELECT user_id,\n        song_id,\n        day\n FROM   listens\n GROUP BY user_id, song_id, day)", "cols": [{"name": "user_id", "sql": "user_id"}, {"name": "song_id", "sql": "song_id"}, {"name": "day", "sql": "day"}]}, {"id": "base_calc", "parentIds": ["base"], "sql": "(SELECT a.user_id as user_id,\n        b.user_id as recommended_id,\n        a.day,\n        count(1) as match_count,\n        concat(a.user_id,\n               \"|\",\n               b.user_id) as f_key\n FROM   base as a join base as b\n         ON a.song_id = b.song_id and\n            a.day = b.day and\n            a.user_id <> b.user_id\n GROUP BY a.user_id, b.user_id, a.day)", "cols": [{"name": "user_id", "sql": "a.user_id AS user_id"}, {"name": "recommended_id", "sql": "b.user_id AS recommended_id"}, {"name": "day", "sql": "a.day"}, {"name": "match_count", "sql": "COUNT(1) AS match_count"}, {"name": "f_key", "sql": "CONCAT(a.user_id, \"|\", b.user_id) AS f_key"}]}, {"id": "exclusion", "parentIds": ["friendship"], "sql": "(SELECT concat(u1,\n               \"|\",\n               u2) as f_key\n FROM   (SELECT user1_id as u1,\n                user2_id as u2\n         FROM   friendship\n         UNION all\nSELECT user2_id,\n                user1_id\n         FROM   friendship) as ex)", "cols": [{"name": "user2_id", "sql": "user2_id"}, {"name": "user1_id", "sql": "user1_id"}]}, {"id": "final", "parentIds": ["base_calc", "exclusion"], "sql": "(SELECT user_id,\n        recommended_id\n FROM   base_calc\n WHERE  match_count >= 3\n    and not f_key in (SELECT f_key\n                   FROM   exclusion)\n GROUP BY user_id, recommended_id)", "cols": [{"name": "f_key", "sql": "f_key"}]}, {"id": "listens", "sql": "select * from listens", "cols": [{"name": "all", "sql": "*"}]}, {"id": "friendship", "sql": "select * from friendship", "cols": [{"name": "all", "sql": "*"}]}]